<!DOCTYPE html>
<head>
  <meta charset="utf-8">
  <title>Textarea Example</title>
  <link rel="icon" href="../static/favicon.ico" type="image/x-icon">
  <!-- dev: http://ghkl/misc-js/doc/textarea.html -->

  <style>
  body {
    padding: 0;
    margin: 0;
  }
  section {
    margin: 20px;
  }
  label span:first-child {
    font-weight: bold;
    display: block;
  }
  textarea {
    box-sizing: border-box;
    /*line-height: 130%;*/
    font: 8pt monospace;
  }
  </style>
  <script src="../textarea.js"></script>
</head>
<body>
  <section>
    <form>
      <label>
        <span>Textarea</span>
        <!-- Snippet from jquery-flags.js (in parent directory) -->
        <textarea name="text1" style="width: 500px">
          var query = {};
          // take the easy outs
          if (querystring === undefined || querystring === null || querystring === '') return query;
          // querystring is something. We'll assume it's a string.
          var parts = querystring.slice(1).split('*');
          parts.forEach(function(part) {
            // we treat `part = 'message='` differently from `part = 'message'`
            var pair_parts = part.split('=');
            var key = pair_parts[0];
            var value = pair_parts[1];
            // value will be undefined or a string, potentially empty, but never null
            if (value === undefined) {
              query[key] = null;
            }
            else {
              query[key] = decodeURIComponent(value);
            }
          });</textarea>
      </label>

      <label><span>Source</span>
        <button id="use_scriptsource">Use Script Source</button>
      </label>

      <label><span>Submit</span>
        <button>Print to console</button>
      </label>
    </form>
  </section>

  <script type="text/plain" id="scriptsource">
        var Flag = (function($) {
          var measureBox = function($el) {
            return {
              width: $el.width() +
                parseInt($el.css('border-left-width'), 10) +
                parseInt($el.css('border-right-width'), 10) +
                parseInt($el.css('padding-left'), 10) +
                parseInt($el.css('padding-right'), 10),
              height: $el.height() +
                parseInt($el.css('border-top-width'), 10) +
                parseInt($el.css('border-bottom-width'), 10) +
                parseInt($el.css('padding-top'), 10) +
                parseInt($el.css('padding-bottom'), 10)
            };
          };
          var opposite_of = {t: 'b', r: 'l', b: 't', l: 'r'}; // opposite sides
          var full = {t: 'top', r: 'right', b: 'bottom', l: 'left', c: 'center', m: 'middle'};

          var template = '<div class="flag"><div class="content"></div><div class="triangle"></div></div>';

          var Flag = function(target, opts) {
            /** new Flag: create a new flag object

            Flag itself should predominantly use Underscore, and only require jQuery for DOM manipulation
            */
            this.target = target;

            this.opts = _.extend({
              anchor: 'r',
              parent: document.body
            }, opts);
          }
        })($);
  </script>

  <script>
  var textarea = document.querySelector('textarea');
  var textarea_enhanced = Textarea.enhance(textarea, {autodedent: true, poll: 500});

  // var shadow = textarea_enhanced.shadow;

  var scriptsource_button = document.getElementById('use_scriptsource')
  scriptsource_button.addEventListener('click', function(ev) {
    ev.preventDefault();

    var scriptsource_string = document.getElementById('scriptsource').innerHTML;
    textarea.value = scriptsource_string;
  }, true);
  </script>
</body>
